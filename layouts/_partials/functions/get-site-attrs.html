{{ $site := . }}
{{ $attrs := dict }}

{{ $logo := partial "functions/resolve-image.html" (dict
        "img" .Site.Params.config.logo "width" 500 "height" 500) }}

{{ $seo := .Site.Params.config.seo }}
{{ $imgName := printf "opengraph%s" (path.Ext $seo.opengraphImage) }}
{{ $ogImage := partial "functions/resolve-image.html" (dict
        "img" $seo.opengraphImage "width" 1200 "height" 630 "newName" $imgName) }}

{{ $imgName = printf "twittercard%s" (path.Ext $seo.twitterCardImage) }}
{{ $tcImage := partial "functions/resolve-image.html" (dict
        "img" $seo.twitterCardImage "width" 1200 "height" 628 "newName" $imgName) }}

{{ $images := dict
        "logo"      $logo.url
        "og_image"  $ogImage.url
        "tc_image"  $tcImage.url
}}

{{ $dateFormat := printf "%s" (.Store.Get "dateFormat") }}
{{ $tagline := .Site.Data.sections.hero.tagline }}
{{ $authorName := .Site.Data.sections.footer.ccHolder | default .Site.Title }}

{{ $twitterHandle := $seo.twitterHandle }}
{{ if not $twitterHandle }}
    {{ $twitterHandle = (or .Site.Data.sections.contact.socials.twitter .Site.Data.sections.contact.socials.x) }}
{{ end }}

{{ $socialUrls := slice }}
{{ $socials := .Site.Data.sections.footer.socials }}

{{ $socialsMap := partial "functions/map-social-urls.html" $socials }}
{{ range $socialsMap }}
    {{ $socialUrls = $socialUrls | append .url }}
{{ end }}

{{ $attrs = merge $attrs (dict
        "url"                   .Site.BaseURL
        "images"                $images
        "title"                 .Site.Title
        "author"                $authorName
        "keywords"              .Site.Params.keywords
        "description"           .Site.Params.description
        "site_title"            (printf "%s | %s" $authorName $tagline)
        "language_dir"          (site.Language.LanguageDirection | default "ltr")
        "language_code"         ((replace .Site.Language.LanguageCode "-" "_") | default "en_US")
        "socials"               $socialUrls
        "copyright_year"        now.Year
        "copyright_holder"      $authorName
        "twitter_handle"        $twitterHandle
        "fb_admins"             $seo.fbAdminsId
        "date_modified"         (.Lastmod | time.Format $dateFormat)
        "date_published"        (.PublishDate | time.Format $dateFormat)) }}

{{ return $attrs }}
